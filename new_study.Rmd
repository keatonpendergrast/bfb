---
title: "Opioid Usage Amongst Behavioural Health Patients: National Trends in the Office Based Prescription of Pain Medications"
output: html_notebook
---

```{r}
## set libraries needed
library(tidyverse)
require(foreign)
require(funModeling)
require(Hmisc)
require(dplyr)
library(tidyr)
require(DataExplorer)
require(readr)
require(tikzDevice)
require(usethis)
library(stringr)
library(goeveg)
require(vctrs)
require(purrr)
```

```{r}
#pull in the datasets from 2006 to 2016
urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2006.tsv"

six <- read.table(url(urlfile), sep = '\t', header = TRUE)

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2007.tsv"

seven <- read.table(url(urlfile), sep = '\t', header = TRUE)

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2008.tsv"

eight <- read.table(url(urlfile), sep = '\t', header = TRUE)

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2009.tsv"

nine <- read.table(url(urlfile), sep = '\t', header = TRUE)

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2010.csv"

ten <- read.csv(url(urlfile))

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2011.csv"

eleven <- read.csv(url(urlfile))

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2012.csv"

twelve <- read.csv(url(urlfile))

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2013.csv"

thirteen <- read.csv(url(urlfile))

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2014.csv"

fourteen <- read.csv(url(urlfile))

urlfile="https://media.githubusercontent.com/media/keatonpendergrast/bfb/master/2015.csv"

fifteen <- read.csv(url(urlfile))

urlfile="https://raw.githubusercontent.com/keatonpendergrast/bfb/master/2016.csv"

sixteen <- read.csv(url(urlfile))

urlfile="https://raw.githubusercontent.com/keatonpendergrast/bfb/master/2016.csv"

sixteen <- read.csv(url(urlfile))
```

```{r}
#add years to each dataset and select for the columns of interest
sixteen$year <- rep(2016,nrow(sixteen))
sixteen <- sixteen %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

fifteen$year <- rep(2015,nrow(fifteen))
fifteen <- fifteen %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

fourteen$year <- rep(2014,nrow(fourteen))
fourteen <- fourteen %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

thirteen$year <- rep(2013,nrow(thirteen))
thirteen <- thirteen %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

twelve$year <- rep(2012,nrow(twelve))
twelve <- twelve %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

eleven$year <- rep(2011,nrow(eleven))
eleven <- eleven %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

ten$year <- rep(2010,nrow(ten))
ten <- ten %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

nine$year <- rep(2009,nrow(nine))
nine <- nine %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

eight$year <- rep(2008,nrow(eight))
eight <- eight %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

seven$year <- rep(2007,nrow(seven))
seven <- seven %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)

six$year <- rep(2006,nrow(six))
six <- six %>% 
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8)
```

```{r}
#combine all into one big dataset and filter for age
data <- rbind(six, seven, eight, nine, ten, eleven, twelve, thirteen, fourteen, fifteen, sixteen) %>%
  filter(AGE >= 18)
```

```{r}
#recode the drugs into names
  data[ data == 25530 ] <- "PROPOXYPHENE"
  data[ data == 25530 ] <- "PROPOXYPHENE" 
  data[ data == 25545 ] <- "PROPOXYPHENE" 
  data[ data == 89071 ] <- "PROPOXYPHENE" 
  data[ data == 93411 ] <- "PROPOXYPHENE" 
  data[ data == 25505 ] <- "PROPOXYPHENE" 
  data[ data == 25515 ] <- "PROPOXYPHENE" 
  data[ data == 25520 ] <- "PROPOXYPHENE" 
  data[ data == 41375 ] <- "PROPOXYPHENE" 
  data[ data == 25525 ] <- "PROPOXYPHENE" 
  data[ data == 25510 ] <- "PROPOXYPHENE" 
  data[ data == 02387 ] <- "REMIFENTANIL" 
  data[ data == 10187 ] <- "SUFENTANIL" 
  data[ data == 01187 ] <- "SUFENTANIL" 
  data[ data == 11121 ] <- "TAPENTADOL" 
  data[ data == 02348 ] <- "OXYCODONE" 
  data[ data == 22305 ] <- "OXYCODONE" 
  data[ data == 22306 ] <- "OXYCODONE" 
  data[ data == 28272 ] <- "OXYCODONE" 
  data[ data == 02828 ] <- "OXYCODONE" 
  data[ data == 22307 ] <- "OXYCODONE" 
  data[ data == 22308 ] <- "OXYCODONE" 
  data[ data == 58273 ] <- "OXYCODONE" 
  data[ data == 00389 ] <- "OXYCODONE" 
  data[ data == 08246 ] <- "OXYCODONE" 
  data[ data == 09582 ] <- "OXYCODONE" 
  data[ data == 12028 ] <- "OXYCODONE" 
  data[ data == 22303 ] <- "OXYCODONE" 
  data[ data == 11270 ] <- "OXYMORPHONE" 
  data[ data == 07701 ] <- "PENTAZOCINE" 
  data[ data == 13117 ] <- "PENTAZOCINE" 
  data[ data == 08338 ] <- "PHENEROL" 
  data[ data == 10426 ] <- "MORPHINE" 
  data[ data == 19655 ] <- "MORPHINE" 
  data[ data == 10403 ] <- "MORPHINE" 
  data[ data == 12008 ] <- "MORPHINE" 
  data[ data == 19650 ] <- "MORPHINE" 
  data[ data == 99123 ] <- "MORPHINE" 
  data[ data == 60990 ] <- "NALBUPHINE" 
  data[ data == 11194 ] <- "Narcotic_Analgesics" 
  data[ data == 98067 ] <- "Narcotic_Analgesics" 
  data[ data == 08202 ] <- "OPIUM" 
  data[ data == 21865 ] <- "OPIUM" 
  data[ data == 27380 ] <- "OPIUM" 
  data[ data == 16190 ] <- "OPIUM" 
  data[ data == 17255 ] <- "OPIUM" 
  data[ data == 91084 ] <- "OPIUM" 
  data[ data == 03064 ] <- "OPIUM" 
  data[ data == 09969 ] <- "OPIUM" 
  data[ data == 21860 ] <- "OPIUM" 
  data[ data == 21870 ] <- "OPIUM" 
  data[ data == 21875 ] <- "OPIUM" 
  data[ data == 21880 ] <- "OPIUM" 
  data[ data == 04589 ] <- "OPIUM" 
  data[ data == 22850 ] <- "OPIUM"
  data[ data == 95085 ] <- "MEPERIDINE"
  data[ data == 17340 ] <- "LEVORPHANOL"
  data[ data == 17362 ] <- "LEVORPHANOL"
  data[ data == 08790 ] <- "MEPERIDINE" 
  data[ data == 02943 ] <- "MEPERIDINE" 
  data[ data == 02955 ] <- "MEPERIDINE" 
  data[ data == 95085 ] <- "MEPERIDINE" 
  data[ data == 00200 ] <- "MEPERIDINE" 
  data[ data == 08785 ] <- "MEPERIDINE" 
  data[ data == 12319 ] <- "MEPERIDINE" 
  data[ data == 18760 ] <- "MEPERIDINE" 
  data[ data == 96045 ] <- "MEPERIDINE" 
  data[ data == 01098 ] <- "MEPERIDINE" 
  data[ data == 04534 ] <- "MEPERIDINE" 
  data[ data == 08093 ] <- "MEPERIDINE" 
  data[ data == 18755 ] <- "MEPERIDINE" 
  data[ data == 96012 ] <- "MEPERIDINE" 
  data[ data == 10130 ] <- "METHADONE" 
  data[ data == 18985 ] <- "METHADONE" 
  data[ data == 91012 ] <- "DEZOCINE" 
  data[ data == 91071 ] <- "DEZOCINE" 
  data[ data == 10715 ] <- "DIHYDROCODEINE" 
  data[ data == 00044 ] <- "DIHYDROCODEINE" 
  data[ data == 03078 ] <- "DIHYDROCODEINE" 
  data[ data == 07467 ] <- "DIHYDROCODEINE" 
  data[ data == 11067 ] <- "DIHYDROCODEINE" 
  data[ data == 11184 ] <- "DIHYDROCODEINE"
  data[ data == 93351 ] <- "DIHYDROCODEINE"
  data[ data == 30340 ] <- "DIHYDROCODEINE"
  data[ data == 10128 ] <- "DIHYDROCODEINE"
  data[ data == 40415 ] <- "DIHYDROCODEINE"
  data[ data == 12061 ] <- "DIHYDROCODEINE" 
  data[ data == 09236 ] <- "DIHYDROCODEINE"
  data[ data == 92082 ] <- "DIHYDROCODEINE"
  data[ data == 09574 ] <- "DIHYDROCODEINE" 
  data[ data == 32225 ] <- "DIHYDROCODEINE" 
  data[ data == 27060 ] <- "DIHYDROCODEINE" 
  data[ data == 12173 ] <- "DIHYDROCODEINE" 
  data[ data == 14890 ] <- "DIHYDROCODEINE" 
  data[ data == 15002 ] <- "DIHYDROCODEINE" 
  data[ data == 07225 ] <- "DIHYDROCODEINE" 
  data[ data == 15650 ] <- "FENTANYL" 
  data[ data == 89034 ] <- "FENTANYL" 
  data[ data == 02067 ] <- "FENTANYL" 
  data[ data == 03307 ] <- "FENTANYL" 
  data[ data == 07197 ] <- "FENTANYL" 
  data[ data == 09508 ] <- "FENTANYL" 
  data[ data == 10442 ] <- "FENTANYL" 
  data[ data == 12243 ] <- "FENTANYL" 
  data[ data == 29645 ] <- "FENTANYL" 
  data[ data == 60565 ] <- "FENTANYL" 
  data[ data == 92024 ] <- "FENTANYL" 
  data[ data == 94188 ] <- "FENTANYL" 
  data[ data == 14770 ] <- "HYDROCODONE" 
  data[ data == 92041 ] <- "HYDROCODONE" 
  data[ data == 92042 ] <- "HYDROCODONE" 
  data[ data == 42245 ] <- "HYDROCODONE" 
  data[ data == 06282 ] <- "HYDROCODONE" 
  data[ data == 00251 ] <- "HYDROCODONE" 
  data[ data == 01268 ] <- "HYDROCODONE" 
  data[ data == 01995 ] <- "HYDROCODONE" 
  data[ data == 02045 ] <- "HYDROCODONE" 
  data[ data == 02082 ] <- "HYDROCODONE" 
  data[ data == 02132 ] <- "HYDROCODONE" 
  data[ data == 02314 ] <- "HYDROCODONE" 
  data[ data == 03518 ] <- "HYDROCODONE" 
  data[ data == 06059 ] <- "HYDROCODONE" 
  data[ data == 07064 ] <- "HYDROCODONE" 
  data[ data == 08354 ] <- "HYDROCODONE" 
  data[ data == 10105 ] <- "HYDROCODONE" 
  data[ data == 11162 ] <- "HYDROCODONE" 
  data[ data == 12194 ] <- "HYDROCODONE" 
  data[ data == 14917 ] <- "HYDROCODONE" 
  data[ data == 34110 ] <- "HYDROCODONE" 
  data[ data == 40860 ] <- "HYDROCODONE" 
  data[ data == 60340 ] <- "HYDROCODONE" 
  data[ data == 02045 ] <- "HYDROCODONE"
  data[ data == 89039 ] <- "HYDROCODONE" 
  data[ data == 92180 ] <- "HYDROCODONE" 
  data[ data == 93077 ] <- "HYDROCODONE" 
  data[ data == 93089 ] <- "HYDROCODONE" 
  data[ data == 96028 ] <- "HYDROCODONE" 
  data[ data == 96047 ] <- "HYDROCODONE" 
  data[ data == 98036 ] <- "HYDROCODONE" 
  data[ data == 98168 ] <- "HYDROCODONE" 
  data[ data == 09516 ] <- "HYDROMORPHONE" 
  data[ data == 09595 ] <- "HYDROMORPHONE" 
  data[ data == 09600 ] <- "HYDROMORPHONE" 
  data[ data == 09641 ] <- "HYDROMORPHONE" 
  data[ data == 11229 ] <- "HYDROMORPHONE" 
  data[ data == 15005 ] <- "HYDROMORPHONE" 
  data[ data == 08220 ] <- "HYDROMORPHONE" 
  data[ data == 27315 ] <- "CODEINE" 
  data[ data == 22415 ] <- "CODEINE" 
  data[ data == 11225 ] <- "CODEINE" 
  data[ data == 08910 ] <- "OPIUM" 
  data[ data == 05054 ] <- "BUPRENORPHINE"  
  data[ data == 10386 ] <- "BUPRENORPHINE"
  data[ data == 60265 ] <- "BUPRENORPHINE" 
  data[ data == 10166 ] <- "BUPRENORPHINE" 
  data[ data == 13141 ] <- "BUPRENORPHINE" 
  data[ data == 05103 ] <- "CODEINE" 
  data[ data == 01021 ] <- "BUTORPHANOL" 
  data[ data == 29285 ] <- "BUTORPHANOL" 
  data[ data == 40765 ] <- "CODEINE" 
  data[ data == 11689 ] <- "CODEINE" 
  data[ data == 14014 ] <- "CODEINE" 
  data[ data == 95178 ] <- "CODEINE" 
  data[ data == 13152 ] <- "CODEINE" 
  data[ data == 24143 ] <- "CODEINE" 
  data[ data == 07155 ] <- "CODEINE" 
  data[ data == 07156 ] <- "CODEINE" 
  data[ data == 07157 ] <- "CODEINE" 
  data[ data == 07158 ] <- "CODEINE" 
  data[ data == 07365 ] <- "CODEINE" 
  data[ data == 25880 ] <- "CODEINE" 
  data[ data == 01853 ] <- "CODEINE" 
  data[ data == 28180 ] <- "CODEINE" 
  data[ data == 41260 ] <- "CODEINE" 
  data[ data == 03520 ] <- "CODEINE" 
  data[ data == 00250 ] <- "CODEINE" 
  data[ data == 00265 ] <- "CODEINE" 
  data[ data == 00270 ] <- "CODEINE" 
  data[ data == 00275 ] <- "CODEINE" 
  data[ data == 00280 ] <- "CODEINE" 
  data[ data == 01758 ] <- "CODEINE" 
  data[ data == 02340 ] <- "CODEINE" 
  data[ data == 02345 ] <- "CODEINE" 
  data[ data == 05151 ] <- "CODEINE" 
  data[ data == 05640 ] <- "CODEINE" 
  data[ data == 07080 ] <- "CODEINE" 
  data[ data == 07165 ] <- "CODEINE" 
  data[ data == 07618 ] <- "CODEINE" 
  data[ data == 09538 ] <- "CODEINE" 
  data[ data == 10457 ] <- "CODEINE" 
  data[ data == 11268 ] <- "CODEINE" 
  data[ data == 23665 ] <- "CODEINE" 
  data[ data == 23670 ] <- "CODEINE" 
  data[ data == 23675 ] <- "CODEINE" 
  data[ data == 23680 ] <- "CODEINE" 
  data[ data == 23635 ] <- "CODEINE" 
  data[ data == 28215 ] <- "CODEINE" 
  data[ data == 32910 ] <- "CODEINE" 
  data[ data == 32915 ] <- "CODEINE" 
  data[ data == 32920 ] <- "CODEINE" 
  data[ data == 32930 ] <- "CODEINE" 
  data[ data == 32935 ] <- "CODEINE" 
  data[ data == 41245 ] <- "CODEINE" 
  data[ data == 91010 ] <- "CODEINE" 
  data[ data == 10128 ] <- "DIHYDROCODEINE" 
  data[ data == 40415 ] <- "DIHYDROCODEINE" 
  data[ data == 02730 ] <- "CODEINES" 
  data[ data == 02735 ] <- "CODEINES" 
  data[ data == 02740 ] <- "CODEINE"
  data[ data == 04770 ] <- "CODEINE" 
  data[ data == 12570 ] <- "CODEINE" 
  data[ data == 01028 ] <- "CODEINE" 
  data[ data == 07180 ] <- "CODEINE" 
  data[ data == 07185 ] <- "CODEINE" 
  data[ data == 07190 ] <- "CODEINE" 
  data[ data == 12072 ] <- "CODEINE" 
  data[ data == 92039 ] <- "CODEINE" 
  data[ data == 23790 ] <- "CODEINE" 
  data[ data == 25430 ] <- "CODEINE" 
  data[ data == 12071 ] <- "CODEINE" 
  data[ data == 13028 ] <- "CODEINE" 
  data[ data == 13838 ] <- "CODEINE" 
  data[ data == 13890 ] <- "CODEINE" 
  data[ data == 26835 ] <- "CODEINE" 
  data[ data == 91027 ] <- "CODEINE" 
  data[ data == 32845 ] <- "CODEINE" 
  data[ data == 23798 ] <- "CODEINE" 
  data[ data == 25415 ] <- "CODEINE" 
  data[ data == 25432 ] <- "CODEINE" 
  data[ data == 25359 ] <- "CODEINE" 
  data[ data == 99072 ] <- "CODEINE" 
  data[ data == 91012 ] <- "DEZOCINE" 
  data[ data == 91071 ] <- "DEZOCINE" 
  data[ data == 00866 ] <- "ALFENTANIL" 
  data[ data == 96145 ] <- "ALFENTANIL" 
  data[ data == 21095 ] <- "ALPHAPRODINE" 
  data[ data == 00197 ] <- "DEXTROPROPOXYPHENE" 
  data[ data == 12046 ] <- "OXYCODONE" 
  data[ data == 15062 ] <- "OXYCODONE" 
  data[ data == 22305 ] <- "OXYCODONE" 
  data[ data == 23385 ] <- "OXYCODONE" 
  data[ data == 26958 ] <- "OXYCODONE" 
  data[ data == 32945 ] <- "OXYCODONE" 
  data[ data == 99114 ] <- "OXYCODONE" 
  data[ data == 22308 ] <- "OXYCODONE" 
  data[ data == 12028 ] <- "OXYCODONE" 
  data[ data == 22303 ] <- "OXYCODONE" 
  data[ data == 96109 ] <- "OXYCODONE" 
  data[ data == 97181 ] <- "OXYCODONE" 
  data[ data == 07701 ] <- "PENTAZOCINE" 
  data[ data == 23285 ] <- "PENTAZOCINE" 
  data[ data == 30535 ] <- "PENTAZOCINE" 
  data[ data == 30540 ] <- "PENTAZOCINE" 
  data[ data == 30513 ] <- "PENTAZOCINE"  
  data[ data == 03245 ] <- "OPIUM" 
  data[ data == 21865 ] <- "OPIUM" 
  data[ data == 03276 ] <- "BUPRENORPHINE" 
  data[ data == 10166 ] <- "BUPRENORPHINE" 
  data[ data == 13141 ] <- "BUPRENORPHINE" 
  data[ data == 15650 ] <- "FENTANYL" 
  data[ data == 89034 ] <- "FENTANYL" 
  data[ data == 09737 ] <- "HYDROCODONE" 
  data[ data == 09751 ] <- "HYDROCODONE" 
  data[ data == 10223 ] <- "HYDROCODONE" 
  data[ data == 98043 ] <- "HYDROCODONE" 
  data[ data == 00389 ] <- "OXYCODONE" 
  data[ data == 05040 ] <- "OXYCODONE" 
  data[ data == 01098 ] <- "MEPERIDINE" 
  data[ data == 04534 ] <- "MEPERIDINE" 
  data[ data == 08093 ] <- "MEPERIDINE"
  data[ data == 18755 ] <- "MEPERIDINE" 
  data[ data == 96012 ] <- "MEPERIDINE"
  data[ data == 04538 ] <- "PENTAZOCINE" 
  data[ data == 13117 ] <- "PENTAZOCINE"
  data[ data == 09516 ] <- "HYDROMORPHONE"
  
  data$AGE[data$AGE == "DIHYDROCODEINE"] <- 44
```

```{r}
#recode the reasons for visits into categories
data[ data == "11000" ] <- "Anxiety_Nervousness"
data[ data == "11005" ] <- "Fears_Phobias"
data[ data == "11100" ] <- "Depression"
data[ data == "11150" ] <- "Anger"
data[ data == "11200" ] <- "Problems_Identity_Self-esteem"
data[ data == "11250" ] <- "Restlessness"
data[ data == "11300" ] <- "Behavioral_Disturbances"
data[ data == "11301" ] <- "Antisocial_Behavior"
data[ data == "11302" ] <- "Hostile_Behavior"
data[ data == "11303" ] <- "Hysterical_Behavior"
data[ data == "11304" ] <- "Temper_Problems"
data[ data == "11305" ] <- "Obsessions_Compulsions"
data[ data == "11350" ] <- "Disturbances_of_Sleep"
data[ data == "11351" ] <- "Insomnia"
data[ data == "11352" ] <- "Hypersomnia"
data[ data == "11353" ] <- "Nightmares"
data[ data == "11354" ] <- "Sleepwalking"
data[ data == "11355" ] <- "Sleep_Apnea"
data[ data == "11450" ] <- "Alcohol-related_Problems"
data[ data == "11500" ] <- "Abnormal_Drug_Usage"
data[ data == "11501" ] <- "Substance_Abuse"
data[ data == "11550" ] <- "Delusions_or_Hallucinations"
data[ data == "11650" ] <- "Other"
```

```{r}
#everyone on the opioid-controlled substances
data$PATWT <- as.numeric(as.character(data$PATWT)) 

data_1 <- data %>%
  select(year, PATWT, AGE, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8) %>%
  unite(MED, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8) %>%
   mutate(rn = row_number()) %>%
   separate_rows(MED) %>%
   filter(MED %in% c("OXYCODONE", "PROPOXYPHENE", "REMIFENTANIL", "SUFENTANIL", "TAPENTADOL", "OXYMORPHONE", "PHENEROL", "MORPHINE", "NALBUPHINE", "Narcotic_Analgesics", "LEVORPHANOL", "MEPERIDINE", "METHADONE", "DIHYDROCODEINE", "FENTANYL", "OXYCODONE", "HYDROMORPHONE", "OPIUM", "BUPRENORPHINE", "BUTORPHANOL", "CODEINE", "PHENYLPROPANOLAMINE", "DEZOCINE", "ALFENTANIL", "ALPHAPRODINE", "DEXTROPROPOXYPHENE", "PENTAZOCINE", "HYDROCODONE")) %>%
   group_by(rn, year, AGE) %>%
   summarise(PATWT = first(PATWT), MED = toString(unique(MED))) %>%
   ungroup() %>%
   select(-rn)

#combine the combinations
    data_1[ data_1 == "HYDROCODONE, BUPRENORPHINE" ] <- "BUPRENORPHINE, HYDROCODONE"
    data_1[ data_1 == "BUPRENORPHINE, OXYCODONE" ] <- "OXYCODONE, BUPRENORPHINE"
    data_1[ data_1 == "BUTORPHANOL, HYDROCODONE" ] <- "HYDROCODONE, BUTORPHANOL"
    data_1[ data_1 == "BUTORPHANOL, OXYCODONE" ] <- "OXYCODONE, BUTORPHANOL"
    data_1[ data_1 == "BUTORPHANOL, CODEINE" ] <- "CODEINE, BUTORPHANOL"
    data_1[ data_1 == "BUTORPHANOL, MEPERIDINE" ] <- "MEPERIDINE, BUTORPHANOL"
    data_1[ data_1 == "CODEINE, HYDROCODONE" ] <- "HYDROCODONE, CODEINE"
    data_1[ data_1 == "CODEINE, HYDROCODONE, FENTANYL" ] <- "HYDROCODONE, FENTANYL, CODEINE"
    data_1[ data_1 == "CODEINE, HYDROCODONE, HYDROMORPHONE" ] <- "HYDROCODONE, HYDROMORPHONE, CODEINE"
    data_1[ data_1 == "CODEINE, HYDROMORPHONE" ] <- "HYDROMORPHONE, CODEINE"
    data_1[ data_1 == "CODEINE, MEPERIDINE" ] <- "MEPERIDINE, CODEINE"
    data_1[ data_1 == "CODEINE, METHADONE" ] <- "METHADONE, CODEINE"
    data_1[ data_1 == "CODEINE, MORPHINE" ] <- "MORPHINE, CODEINE"
    data_1[ data_1 == "CODEINE, OXYCODONE" ] <- "OXYCODONE, CODEINE"
    data_1[ data_1 == "CODEINE, MORPHINE, OXYCODONE" ] <- "OXYCODONE, MORPHINE, CODEINE"
    data_1[ data_1 == "CODEINE, OPIUM" ] <- "OPIUM, CODEINE"
    data_1[ data_1 == "CODEINE, OXYCODONE" ] <- "OXYCODONE, CODEINE"
    data_1[ data_1 == "CODEINE, OXYCODONE, HYDROCODONE" ] <- "OXYCODONE, HYDROCODONE, CODEINE"
    data_1[ data_1 == "CODEINE, OXYCODONE, MORPHINE" ] <- "OXYCODONE, MORPHINE, CODEINE"
    data_1[ data_1 == "CODEINE, PENTAZOCINE" ] <- "PENTAZOCINE, CODEINE"
    data_1[ data_1 == "CODEINE, FENTANYL" ] <- "FENTANYL, CODEINE"
    data_1[ data_1 == "CODEINE, PROPOXYPHENE, OXYCODONE" ] <- "OXYCODONE, PROPOXYPHENE, CODEINE"
    data_1[ data_1 == "CODEINE, PROPOXYPHENE" ] <- "PROPOXYPHENE, CODEINE"
    data_1[ data_1 == "DIHYDROCODEINE, HYDROCODONE" ] <- "HYDROCODONE, DIHYDROCODEINE"
    data_1[ data_1 == "DIHYDROCODEINE, OXYCODONE" ] <- "OXYCODONE, DIHYDROCODEINE"
    data_1[ data_1 == "FENTANYL, HYDROCODONE" ] <- "HYDROCODONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, MORPHINE" ] <- "MORPHINE, FENTANYL"
    data_1[ data_1 == "FENTANYL, OXYCODONE" ] <- "OXYCODONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, OXYCODONE, MEPERIDINE" ] <- "OXYCODONE, MEPERIDINE, FENTANYL"
    data_1[ data_1 == "FENTANYL, HYDROCODONE, OPIUM" ] <- "HYDROCODONE, FENTANYL, OPIUM"
    data_1[ data_1 == "FENTANYL, HYDROCODONE, OXYCODONE" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, METHADONE, OXYCODONE" ] <- "OXYCODONE, METHADONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, HYDROCODONE, MORPHINE" ] <- "HYDROCODONE, MORPHINE, FENTANYL"
    data_1[ data_1 == "FENTANYL, MEPERIDINE" ] <- "MEPERIDINE, FENTANYL"
    data_1[ data_1 == "FENTANYL, OPIUM" ] <- "OPIUM, FENTANYL"
    data_1[ data_1 == "FENTANYL, OXYCODONE, HYDROCODONE" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, OXYCODONE, METHADONE" ] <- "OXYCODONE, METHADONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, METHADONE" ] <- "METHADONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, METHADONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, METHADONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, HYDROMORPHONE" ] <- "HYDROMORPHONE, FENTANYL"
    data_1[ data_1 == "FENTANYL, HYDROMORPHONE, MORPHINE" ] <- "HYDROMORPHONE, MORPHINE, FENTANYL"
    data_1[ data_1 == "HYDROCODONE, MORPHINE" ] <- "MORPHINE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, OXYCODONE" ] <- "OXYCODONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, OXYCODONE, MEPERIDINE" ] <- "OXYCODONE, MEPERIDINE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, OPIUM, FENTANYL" ] <- "HYDROCODONE, FENTANYL, OPIUM"
    data_1[ data_1 == "HYDROCODONE, FENTANYL, OXYCODONE" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "HYDROCODONE, METHADONE, OXYCODONE" ] <- "OXYCODONE, METHADONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, FENTANYL, MORPHINE" ] <- "HYDROCODONE, MORPHINE, FENTANYL"
    data_1[ data_1 == "HYDROCODONE, MEPERIDINE" ] <- "MEPERIDINE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, OPIUM" ] <- "OPIUM, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, OXYCODONE, FENTANYL" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "HYDROCODONE, OXYCODONE, METHADONE" ] <- "OXYCODONE, METHADONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, METHADONE" ] <- "METHADONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, METHADONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, METHADONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, HYDROCODONE"
    data_1[ data_1 == "HYDROCODONE, HYDROMORPHONE, MORPHINE" ] <- "HYDROCODONE, MORPHINE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, MORPHINE" ] <- "MORPHINE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, OXYCODONE" ] <- "OXYCODONE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, OXYCODONE, MEPERIDINE" ] <- "OXYCODONE, HYDROMORPHONE, MEPERIDINE"
    data_1[ data_1 == "HYDROMORPHONE, OPIUM, FENTANYL" ] <- "HYDROMORPHONE, FENTANYL, OPIUM"
    data_1[ data_1 == "HYDROMORPHONE, FENTANYL, OXYCODONE" ] <- "OXYCODONE, HYDROMORPHONE, FENTANYL"
    data_1[ data_1 == "HYDROMORPHONE, METHADONE, OXYCODONE" ] <- "OXYCODONE, METHADONE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, FENTANYL, MORPHINE" ] <- "HYDROMORPHONE, MORPHINE, FENTANYL"
    data_1[ data_1 == "MEPERIDINE, HYDROMORPHONE" ] <- "HYDROMORPHONE, MEPERIDINE"
    data_1[ data_1 == "HYDROMORPHONE, OPIUM" ] <- "OPIUM, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, OXYCODONE, FENTANYL" ] <- "OXYCODONE, HYDROMORPHONE, FENTANYL"
    data_1[ data_1 == "HYDROMORPHONE, OXYCODONE, METHADONE" ] <- "OXYCODONE, METHADONE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, METHADONE" ] <- "METHADONE, HYDROMORPHONE"
    data_1[ data_1 == "HYDROMORPHONE, METHADONE, HYDROCODONE" ] <- "HYDROCODONE, HYDROMORPHONE, METHADONE"
    data_1[ data_1 == "HYDROMORPHONE, HYDROMORPHONE, MORPHINE" ] <- "HYDROMORPHONE, MORPHINE, HYDROMORPHONE"
    data_1[ data_1 == "MEPERIDINE, MORPHINE" ] <- "MORPHINE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OXYCODONE" ] <- "OXYCODONE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OXYCODONE, MEPERIDINE" ] <- "OXYCODONE, MEPERIDINE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OPIUM, FENTANYL" ] <- "FENTANYL, OPIUM, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, FENTANYL, OXYCODONE" ] <- "OXYCODONE, MEPERIDINE, FENTANYL"
    data_1[ data_1 == "MEPERIDINE, METHADONE, OXYCODONE" ] <- "OXYCODONE, METHADONE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, FENTANYL, MORPHINE" ] <- "MORPHINE, FENTANYL, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OPIUM" ] <- "OPIUM, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OXYCODONE, FENTANYL" ] <- "OXYCODONE, FENTANYL, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, OXYCODONE, METHADONE" ] <- "OXYCODONE, METHADONE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, METHADONE" ] <- "METHADONE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, METHADONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, METHADONE, MEPERIDINE"
    data_1[ data_1 == "MEPERIDINE, METHADONE, MORPHINE" ] <- "MORPHINE, METHADONE, MEPERIDINE"
    data_1[ data_1 == "OXYCODONE, MORPHINE" ] <- "MORPHINE, OXYCODONE"
    data_1[ data_1 == "OXYCODONE, HYDROCODONE, MEPERIDINE" ] <- "OXYCODONE, HYDROCODONE, MEPERIDINE"
    data_1[ data_1 == "OXYCODONE, OPIUM, FENTANYL" ] <- "OXYCODONE, FENTANYL, OPIUM"
    data_1[ data_1 == "OXYCODONE, FENTANYL, HYDROCODONE" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "OXYCODONE, METHADONE, HYDROCODONE" ] <- "OXYCODONE, HYDROCODONE, METHADONE"
    data_1[ data_1 == "OXYCODONE, FENTANYL, MORPHINE" ] <- "OXYCODONE, MORPHINE, FENTANYL"
    data_1[ data_1 == "OXYCODONE, MEPERIDINE" ] <- "MEPERIDINE, OXYCODONE"
    data_1[ data_1 == "OXYCODONE, OPIUM" ] <- "OPIUM, OXYCODONE"
    data_1[ data_1 == "OXYCODONE, HYDROCODONE, FENTANYL" ] <- "OXYCODONE, HYDROCODONE, FENTANYL"
    data_1[ data_1 == "OXYCODONE, HYDROCODONE, METHADONE" ] <- "OXYCODONE, HYDROCODONE, METHADONE"
    data_1[ data_1 == "PROPOXYPHENE, OXYCODONE" ] <- "OXYCODONE, PROPOXYPHENE"
    data_1[ data_1 == "METHADONE, OXYCODONE" ] <- "OXYCODONE, METHADONE"
    data_1[ data_1 == "OXYCODONE, METHADONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, METHADONE, OXYCODONE"
    data_1[ data_1 == "OXYCODONE, HYDROMORPHONE" ] <- "HYDROMORPHONE, OXYCODONE"
    data_1[ data_1 == "OXYCODONE, HYDROMORPHONE, MORPHINE" ] <- "OXYCODONE, MORPHINE, HYDROMORPHONE"

data_0 <- data_1 %>%
  group_by(year) %>%
  summarise(sum = sum(PATWT, na.rm=T))

data_0$sum <- as.numeric(as.character(data_0$sum))

close0 <- data_0 %>%
  filter(year == 2006) %>%
  mutate(prop = (sum/sum(six$PATWT))*100)
close11 <- data_0 %>%
  filter(year == 2007) %>%
  mutate(prop = (sum/sum(seven$PATWT))*100)
close22 <- data_0 %>%
  filter(year == 2008) %>%
  mutate(prop = (sum/sum(eight$PATWT))*100)
close33 <- data_0 %>%
  filter(year == 2009) %>%
  mutate(prop = (sum/sum(nine$PATWT))*100)
close44 <- data_0 %>%
  filter(year == 2010) %>%
  mutate(prop = (sum/sum(ten$PATWT))*100)
close55 <- data_0 %>%
  filter(year == 2011) %>%
  mutate(prop = (sum/sum(eleven$PATWT))*100)
close66 <- data_0 %>%
  filter(year == 2012) %>%
  mutate(prop = (sum/sum(twelve$PATWT))*100)
close77 <- data_0 %>%
  filter(year == 2013) %>%
  mutate(prop = (sum/sum(thirteen$PATWT))*100)
close88 <- data_0 %>%
  filter(year == 2014) %>%
  mutate(prop = (sum/sum(fourteen$PATWT))*100)
close99 <- data_0 %>%
  filter(year == 2015) %>%
  mutate(prop = (sum/sum(fifteen$PATWT))*100)
close100 <- data_0 %>%
  filter(year == 2016) %>%
  mutate(prop = (sum/sum(sixteen$PATWT))*100)

data_0summary <- rbind(close0, close11, close22, close33, close44, close55, close66, close77, close88, close99, close100) %>%
  select(year, prop)
  
write.csv(data_0summary, file = "everyone_on_opioids.csv")

close03 <- data_0 %>%
  filter(year == 2006) %>%
  mutate(prop = sum(six$PATWT))
close113 <- data_0 %>%
  filter(year == 2007) %>%
  mutate(prop = sum(seven$PATWT))
close223 <- data_0 %>%
  filter(year == 2008) %>%
  mutate(prop = sum(eight$PATWT))
close333 <- data_0 %>%
  filter(year == 2009) %>%
  mutate(prop = sum(nine$PATWT))
close443 <- data_0 %>%
  filter(year == 2010) %>%
  mutate(prop = sum(ten$PATWT))
close553 <- data_0 %>%
  filter(year == 2011) %>%
  mutate(prop = sum(eleven$PATWT))
close663 <- data_0 %>%
  filter(year == 2012) %>%
  mutate(prop = sum(twelve$PATWT))
close773 <- data_0 %>%
  filter(year == 2013) %>%
  mutate(prop = sum(thirteen$PATWT))
close883 <- data_0 %>%
  filter(year == 2014) %>%
  mutate(prop = sum(fourteen$PATWT))
close993 <- data_0 %>%
  filter(year == 2015) %>%
  mutate(prop = sum(fifteen$PATWT))
close1003 <- data_0 %>%
  filter(year == 2016) %>%
  mutate(prop = sum(sixteen$PATWT))

data_0summary22 <- rbind(close03, close113, close223, close333, close443, close553, close663, close773, close883, close993, close1003) %>%
  mutate(no = prop) %>%
  mutate(yes = sum) %>%
  select(year, yes, no)

proptest <- pairwise.prop.test(data_0summary22$yes, data_0summary22$no)
proptest

proptrend <- prop.trend.test(data_0summary22$yes, data_0summary22$no)
proptrend
```

```{r}
#behavioural health patients total
new <- data %>%
  select(year, AGE, PATWT, RFV1, RFV2, RFV3) %>%
  unite(RFV, RFV1, RFV2, RFV3) %>%
   mutate(rn = row_number()) %>%
   separate_rows(RFV) %>%
   filter(RFV %in% c("Anxiety_Nervousness", "Fears_Phobias", "Depression", "Anger", "Problems_Identity_Self-esteem", "Restlessness", "Behavioral_Disturbances", "Antisocial_Behavior", "Hostile_Behavior", "Narcotic_Analgesics", "Hysterical_Behavior", "Temper_Problems", "Obsessions_Compulsions", "Disturbances_of_Sleep", "Insomnia", "Hypersomnia", "Nightmares", "Sleepwalking", "Sleep_Apnea", "Alcohol-related_Problems", "Abnormal_Drug_Usage", "Substance_Abuse", "Delusions_or_Hallucinations", "Other"))

new$AGE <- as.numeric(as.character(new$AGE)) 

new2 <- new %>%
  select(year, PATWT, AGE) %>%
  group_by(year) %>%
  summarise(sum = sum(PATWT, na.rm=T), avg_age = mean(AGE, na.rm=T), sd_age = sem(AGE, na.rm=T))

new3 <- new %>%
  group_by(year) %>%
  summarise(sum = sum(PATWT, na.rm = TRUE))
```

```{r}
# the opioid rate PER year amongst ALL patients BY drug name including AGE
data_1$AGE <- as.numeric(as.character(data_1$AGE))

data_2 <- data_1 %>%
  group_by(year, MED) %>%
  summarise(sum = sum(PATWT, na.rm=T), avg_age = mean(AGE, na.rm=T), sd_age = sem(AGE, na.rm=T))

data_2$sum <- as.numeric(as.character(data_2$sum)) 

data_2bc <- data_1 %>%
  group_by(year, MED) %>%
  summarise(sum = sum(PATWT)) %>%
  mutate(row = row_number()) %>%
  separate_rows(MED) %>%
  pivot_wider(names_from = MED, values_from = sum) %>%
  select(-row) %>%
  group_by(year) %>%
  summarise(OXYCODONE = sum(OXYCODONE, na.rm=TRUE), PROPOXYPHENE = sum(PROPOXYPHENE, na.rm=TRUE), SUFENTANIL = sum(SUFENTANIL, na.rm=TRUE), TAPENTADOL = sum(TAPENTADOL, na.rm=TRUE), OXYMORPHONE = sum(OXYMORPHONE, na.rm=TRUE), MORPHINE = sum(MORPHINE, na.rm=TRUE), NALBUPHINE = sum(NALBUPHINE, na.rm=TRUE), LEVORPHANOL = sum(LEVORPHANOL, na.rm=TRUE), MEPERIDINE = sum(MEPERIDINE, na.rm=TRUE), METHADONE = sum(METHADONE, na.rm=TRUE), DIHYDROCODEINE = sum(DIHYDROCODEINE, na.rm=TRUE), FENTANYL = sum(FENTANYL, na.rm=TRUE), HYDROMORPHONE = sum(HYDROMORPHONE, na.rm=TRUE), OPIUM = sum(OPIUM, na.rm=TRUE), BUPRENORPHINE = sum(BUPRENORPHINE, na.rm=TRUE), BUTORPHANOL = sum(BUTORPHANOL, na.rm=TRUE), CODEINE = sum(CODEINE, na.rm=TRUE), PENTAZOCINE = sum(PENTAZOCINE, na.rm=TRUE), HYDROCODONE = sum(HYDROCODONE, na.rm=TRUE))

close0 <- data_2bc %>%
  filter(year == 2006) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(six$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(six$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(six$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(six$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(six$PATWT))*100, MORPHINE = (MORPHINE/sum(six$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(six$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(six$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(six$PATWT))*100, METHADONE = (METHADONE/sum(six$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(six$PATWT))*100, FENTANYL = (FENTANYL/sum(six$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(six$PATWT))*100, OPIUM = (OPIUM/sum(six$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(six$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(six$PATWT))*100, CODEINE = (CODEINE/sum(six$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(six$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(six$PATWT))*100) %>%
  mutate(year = 2006)
close11 <- data_2bc %>%
  filter(year == 2007) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(seven$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(seven$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(seven$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(seven$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(seven$PATWT))*100, MORPHINE = (MORPHINE/sum(seven$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(seven$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(seven$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(seven$PATWT))*100, METHADONE = (METHADONE/sum(seven$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(seven$PATWT))*100, FENTANYL = (FENTANYL/sum(seven$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(seven$PATWT))*100, OPIUM = (OPIUM/sum(seven$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(seven$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(seven$PATWT))*100, CODEINE = (CODEINE/sum(seven$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(seven$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(seven$PATWT))*100) %>%
  mutate(year = 2007)
close22 <- data_2bc %>%
  filter(year == 2008) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(eight$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(eight$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(eight$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(eight$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(eight$PATWT))*100, MORPHINE = (MORPHINE/sum(eight$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(eight$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(eight$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(eight$PATWT))*100, METHADONE = (METHADONE/sum(eight$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(eight$PATWT))*100, FENTANYL = (FENTANYL/sum(eight$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(eight$PATWT))*100, OPIUM = (OPIUM/sum(eight$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(eight$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(eight$PATWT))*100, CODEINE = (CODEINE/sum(eight$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(eight$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(eight$PATWT))*100) %>%
  mutate(year = 2008)
close33 <- data_2bc %>%
  filter(year == 2009) %>%
    summarise(OXYCODONE = (OXYCODONE/sum(nine$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(nine$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(nine$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(nine$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(nine$PATWT))*100, MORPHINE = (MORPHINE/sum(nine$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(nine$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(nine$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(nine$PATWT))*100, METHADONE = (METHADONE/sum(nine$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(nine$PATWT))*100, FENTANYL = (FENTANYL/sum(nine$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(nine$PATWT))*100, OPIUM = (OPIUM/sum(nine$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(nine$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(nine$PATWT))*100, CODEINE = (CODEINE/sum(nine$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(nine$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(nine$PATWT))*100) %>%
  mutate(year = 2009)
close44 <- data_2bc %>%
  filter(year == 2010) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(ten$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(ten$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(ten$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(ten$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(ten$PATWT))*100, MORPHINE = (MORPHINE/sum(ten$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(ten$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(ten$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(ten$PATWT))*100, METHADONE = (METHADONE/sum(ten$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(ten$PATWT))*100, FENTANYL = (FENTANYL/sum(ten$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(ten$PATWT))*100, OPIUM = (OPIUM/sum(ten$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(ten$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(ten$PATWT))*100, CODEINE = (CODEINE/sum(ten$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(ten$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(ten$PATWT))*100) %>%
  mutate(year = 2010)
close55 <- data_2bc %>%
  filter(year == 2011) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(eleven$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(eleven$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(eleven$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(eleven$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(eleven$PATWT))*100, MORPHINE = (MORPHINE/sum(eleven$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(eleven$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(eleven$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(eleven$PATWT))*100, METHADONE = (METHADONE/sum(eleven$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(eleven$PATWT))*100, FENTANYL = (FENTANYL/sum(eleven$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(eleven$PATWT))*100, OPIUM = (OPIUM/sum(eleven$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(eleven$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(eleven$PATWT))*100, CODEINE = (CODEINE/sum(eleven$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(eleven$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(eleven$PATWT))*100) %>%
  mutate(year = 2011)
close66 <- data_2bc %>%
  filter(year == 2012) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(twelve$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(twelve$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(twelve$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(twelve$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(twelve$PATWT))*100, MORPHINE = (MORPHINE/sum(twelve$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(twelve$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(twelve$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(twelve$PATWT))*100, METHADONE = (METHADONE/sum(twelve$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(twelve$PATWT))*100, FENTANYL = (FENTANYL/sum(twelve$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(twelve$PATWT))*100, OPIUM = (OPIUM/sum(twelve$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(twelve$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(twelve$PATWT))*100, CODEINE = (CODEINE/sum(twelve$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(twelve$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(twelve$PATWT))*100) %>%
  mutate(year = 2012)
close77 <- data_2bc %>%
  filter(year == 2013) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(thirteen$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(thirteen$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(thirteen$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(thirteen$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(thirteen$PATWT))*100, MORPHINE = (MORPHINE/sum(thirteen$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(thirteen$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(thirteen$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(thirteen$PATWT))*100, METHADONE = (METHADONE/sum(thirteen$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(thirteen$PATWT))*100, FENTANYL = (FENTANYL/sum(thirteen$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(thirteen$PATWT))*100, OPIUM = (OPIUM/sum(thirteen$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(thirteen$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(thirteen$PATWT))*100, CODEINE = (CODEINE/sum(thirteen$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(thirteen$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(thirteen$PATWT))*100) %>%
  mutate(year = 2013)
close88 <- data_2bc %>%
  filter(year == 2014) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(fourteen$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(fourteen$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(fourteen$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(fourteen$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(fourteen$PATWT))*100, MORPHINE = (MORPHINE/sum(fourteen$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(fourteen$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(fourteen$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(fourteen$PATWT))*100, METHADONE = (METHADONE/sum(fourteen$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(fourteen$PATWT))*100, FENTANYL = (FENTANYL/sum(fourteen$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(fourteen$PATWT))*100, OPIUM = (OPIUM/sum(fourteen$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(fourteen$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(fourteen$PATWT))*100, CODEINE = (CODEINE/sum(fourteen$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(fourteen$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(fourteen$PATWT))*100) %>%
  mutate(year = 2014)
close99 <- data_2bc %>%
  filter(year == 2015) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(fifteen$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(fifteen$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(fifteen$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(fifteen$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(fifteen$PATWT))*100, MORPHINE = (MORPHINE/sum(fifteen$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(fifteen$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(fifteen$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(fifteen$PATWT))*100, METHADONE = (METHADONE/sum(fifteen$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(fifteen$PATWT))*100, FENTANYL = (FENTANYL/sum(fifteen$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(fifteen$PATWT))*100, OPIUM = (OPIUM/sum(fifteen$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(fifteen$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(fifteen$PATWT))*100, CODEINE = (CODEINE/sum(fifteen$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(fifteen$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(fifteen$PATWT))*100) %>%
  mutate(year = 2015)
close100 <- data_2bc %>%
  filter(year == 2016) %>%
  summarise(OXYCODONE = (OXYCODONE/sum(sixteen$PATWT))*100, PROPOXYPHENE = (PROPOXYPHENE/sum(sixteen$PATWT))*100, SUFENTANIL = (SUFENTANIL/sum(sixteen$PATWT))*100, TAPENTADOL = (TAPENTADOL/sum(sixteen$PATWT))*100, OXYMORPHONE = (OXYMORPHONE/sum(sixteen$PATWT))*100, MORPHINE = (MORPHINE/sum(sixteen$PATWT))*100, NALBUPHINE = (NALBUPHINE/sum(sixteen$PATWT))*100, LEVORPHANOL = (LEVORPHANOL/sum(sixteen$PATWT))*100, MEPERIDINE = (MEPERIDINE/sum(sixteen$PATWT))*100, METHADONE = (METHADONE/sum(sixteen$PATWT))*100, DIHYDROCODEINE = (DIHYDROCODEINE/sum(sixteen$PATWT))*100, FENTANYL = (FENTANYL/sum(sixteen$PATWT))*100, HYDROMORPHONE = (HYDROMORPHONE/sum(sixteen$PATWT))*100, OPIUM = (OPIUM/sum(sixteen$PATWT))*100, BUPRENORPHINE = (BUPRENORPHINE/sum(sixteen$PATWT))*100, BUTORPHANOL = (BUTORPHANOL/sum(sixteen$PATWT))*100, CODEINE = (CODEINE/sum(sixteen$PATWT))*100, PENTAZOCINE = (PENTAZOCINE/sum(sixteen$PATWT))*100, HYDROCODONE = (HYDROCODONE/sum(sixteen$PATWT))*100) %>%
  mutate(year = 2016)

data_2summary <- rbind(close0, close11, close22, close33, close44, close55, close66, close77, close88, close99, close100)

write.csv(data_2summary, file = "opioids_all_byname.csv")
```

```{r}
#all patients by drug
data_2q <- data_2bc %>%
   pivot_longer(
      cols = OXYCODONE:HYDROCODONE, 
      names_to = "MED", 
      values_to = "yes")

close03a <- data_2q %>%
  filter(year == 2006) %>%
  mutate(prop = sum(six$PATWT))
close113a <- data_2q %>%
  filter(year == 2007) %>%
  mutate(prop = sum(seven$PATWT))
close223a <- data_2q %>%
  filter(year == 2008) %>%
  mutate(prop = sum(eight$PATWT))
close333a <- data_2q %>%
  filter(year == 2009) %>%
  mutate(prop = sum(nine$PATWT))
close443a <- data_2q %>%
  filter(year == 2010) %>%
  mutate(prop = sum(ten$PATWT))
close553a <- data_2q %>%
  filter(year == 2011) %>%
  mutate(prop = sum(eleven$PATWT))
close663a <- data_2q %>%
  filter(year == 2012) %>%
  mutate(prop = sum(twelve$PATWT))
close773a <- data_2q %>%
  filter(year == 2013) %>%
  mutate(prop = sum(thirteen$PATWT))
close883a <- data_2q %>%
  filter(year == 2014) %>%
  mutate(prop = sum(fourteen$PATWT))
close993a <- data_2q %>%
  filter(year == 2015) %>%
  mutate(prop = sum(fifteen$PATWT))
close1003a <- data_2q %>%
  filter(year == 2016) %>%
  mutate(prop = sum(sixteen$PATWT))


data_2summarya <- rbind(close03a, close113a, close223a, close333a, close443a, close553a, close663a, close773a, close883a, close993a, close1003a) %>%
  mutate(no = prop) %>%
  select(year, MED, yes, no)

unique(data_2summarya$MED)
```

```{r}
#stats tests of ALL patients by drug
LEVORPHANOL <- data_2summarya %>%
  filter(MED == "LEVORPHANOL")

proptest_lev <- pairwise.prop.test(LEVORPHANOL$yes, LEVORPHANOL$no)
proptest_lev

proptrend_lev <- prop.trend.test(LEVORPHANOL$yes, LEVORPHANOL$no)
proptrend_lev

NALBUPHINE <- data_2summarya %>%
  filter(MED == "NALBUPHINE")

proptest_nal <- pairwise.prop.test(NALBUPHINE$yes, NALBUPHINE$no)
proptest_nal

proptrend_nal <- prop.trend.test(NALBUPHINE$yes, NALBUPHINE$no)
proptrend_nal

OXYMORPHONE <- data_2summarya %>%
  filter(MED == "OXYMORPHONE")

proptest_oxm <- pairwise.prop.test(OXYMORPHONE$yes, OXYMORPHONE$no)
proptest_oxm

proptrend_oxm <- prop.trend.test(OXYMORPHONE$yes, OXYMORPHONE$no)
proptrend_oxm

TAPENTADOL <- data_2summarya %>%
  filter(MED == "TAPENTADOL")

proptest_tap <- pairwise.prop.test(TAPENTADOL$yes, TAPENTADOL$no)
proptest_tap

proptrend_tap <- prop.trend.test(TAPENTADOL$yes, TAPENTADOL$no)
proptrend_tap

SUFENTANIL <- data_2summarya %>%
  filter(MED == "SUFENTANIL")

proptest_suf <- pairwise.prop.test(SUFENTANIL$yes, SUFENTANIL$no)
proptest_suf

proptrend_suf <- prop.trend.test(SUFENTANIL$yes, SUFENTANIL$no)
proptrend_suf

codeine <- data_2summarya %>%
  filter(MED == "CODEINE")

proptest_cod <- pairwise.prop.test(codeine$yes, codeine$no)
proptest_cod

proptrend_cod <- prop.trend.test(codeine$yes, codeine$no)
proptrend_cod

BUPRENORPHINE <- data_2summarya %>%
  filter(MED == "BUPRENORPHINE")

proptest_bup <- pairwise.prop.test(BUPRENORPHINE$yes, BUPRENORPHINE$no)
proptest_bup

proptrend_bup <- prop.trend.test(BUPRENORPHINE$yes, BUPRENORPHINE$no)
proptrend_bup

FENTANYL <- data_2summarya %>%
  filter(MED == "FENTANYL")

proptest_fen <- pairwise.prop.test(FENTANYL$yes, FENTANYL$no)
proptest_fen

proptrend_fen <- prop.trend.test(FENTANYL$yes, FENTANYL$no)
proptrend_fen

BUTORPHANOL <- data_2summarya %>%
  filter(MED == "BUTORPHANOL")

proptest_but <- pairwise.prop.test(BUTORPHANOL$yes, BUTORPHANOL$no)
proptest_but

proptrend_but <- prop.trend.test(BUTORPHANOL$yes, BUTORPHANOL$no)
proptrend_but

DIHYDROCODEINE <- data_2summarya %>%
  filter(MED == "DIHYDROCODEINE")

proptest_dih <- pairwise.prop.test(DIHYDROCODEINE$yes, DIHYDROCODEINE$no)
proptest_dih

proptrend_dih <- prop.trend.test(DIHYDROCODEINE$yes, DIHYDROCODEINE$no)
proptrend_dih

HYDROMORPHONE <- data_2summarya %>%
  filter(MED == "HYDROMORPHONE")

proptest_hmo <- pairwise.prop.test(HYDROMORPHONE$yes, HYDROMORPHONE$no)
proptest_hmo

proptrend_hmo <- prop.trend.test(HYDROMORPHONE$yes, HYDROMORPHONE$no)
proptrend_hmo

HYDROCODONE <- data_2summarya %>%
  filter(MED == "HYDROCODONE")

proptest_hyo <- pairwise.prop.test(HYDROCODONE$yes, HYDROCODONE$no)
proptest_hyo

proptrend_hyo <- prop.trend.test(HYDROCODONE$yes, HYDROCODONE$no)
proptrend_hyo

MEPERIDINE <- data_2summarya %>%
  filter(MED == "MEPERIDINE")

proptest_mep <- pairwise.prop.test(MEPERIDINE$yes, MEPERIDINE$no)
proptest_mep

proptrend_mep <- prop.trend.test(MEPERIDINE$yes, MEPERIDINE$no)
proptrend_mep

METHADONE <- data_2summarya %>%
  filter(MED == "METHADONE")

proptest_met <- pairwise.prop.test(METHADONE$yes, METHADONE$no)
proptest_met

proptrend_met <- prop.trend.test(METHADONE$yes, METHADONE$no)
proptrend_met


MORPHINE <- data_2summarya %>%
  filter(MED == "MORPHINE")

proptest_mor <- pairwise.prop.test(MORPHINE$yes, MORPHINE$no)
proptest_mor

proptrend_mor <- prop.trend.test(MORPHINE$yes, MORPHINE$no)
proptrend_mor


OPIUM <- data_2summarya %>%
  filter(MED == "OPIUM")

proptest_opi <- pairwise.prop.test(OPIUM$yes, OPIUM$no)
proptest_opi

proptrend_opi <- prop.trend.test(OPIUM$yes, OPIUM$no)
proptrend_opi

OXYCODONE <- data_2summarya %>%
  filter(MED == "OXYCODONE")

proptest_oxy <- pairwise.prop.test(OXYCODONE$yes, OXYCODONE$no)
proptest_oxy

proptrend_oxy <- prop.trend.test(OXYCODONE$yes, OXYCODONE$no)
proptrend_oxy


PENTAZOCINE <- data_2summarya %>%
  filter(MED == "PENTAZOCINE")

proptest_ope <- pairwise.prop.test(PENTAZOCINE$yes, PENTAZOCINE$no)
proptest_ope

proptrend_ope <- prop.trend.test(PENTAZOCINE$yes, PENTAZOCINE$no)
proptrend_ope

PROPOXYPHENE <- data_2summarya %>%
  filter(MED == "PROPOXYPHENE")

proptest_pro <- pairwise.prop.test(PROPOXYPHENE$yes, PROPOXYPHENE$no)
proptest_pro

proptrend_pro <- prop.trend.test(PROPOXYPHENE$yes, PROPOXYPHENE$no)
proptrend_pro

BUPRENORPHINE <- data_2summarya %>%
  filter(MED == "BUPRENORPHINE")

proptest_bne <- pairwise.prop.test(BUPRENORPHINE$yes, BUPRENORPHINE$no)
proptest_bne

proptrend_bne <- prop.trend.test(BUPRENORPHINE$yes, BUPRENORPHINE$no)
proptrend_bne

BUTORPHANOL <- data_2summarya %>%
  filter(MED == "BUTORPHANOL")

proptest_bnl <- pairwise.prop.test(BUTORPHANOL$yes, BUTORPHANOL$no)
proptest_bnl

proptrend_bnl <- prop.trend.test(BUTORPHANOL$yes, BUTORPHANOL$no)
proptrend_bnl
```

```{r}
# the opioid rate PER year amongst ALL patients
data_3 <- data_1 %>%
  group_by(year) %>%
  summarise(sum = sum(PATWT, na.rm=T))

data_3$sum <- as.numeric(as.character(data_3$sum)) 

close0 <- data_3 %>%
  filter(year == 2006) %>%
  mutate(prop = (sum/sum(six$PATWT))*100)
close11 <- data_3 %>%
  filter(year == 2007) %>%
  mutate(prop = (sum/sum(seven$PATWT))*100)
close22 <- data_3 %>%
  filter(year == 2008) %>%
  mutate(prop = (sum/sum(eight$PATWT))*100)
close33 <- data_3 %>%
  filter(year == 2009) %>%
  mutate(prop = (sum/sum(nine$PATWT))*100)
close44 <- data_3 %>%
  filter(year == 2010) %>%
  mutate(prop = (sum/sum(ten$PATWT))*100)
close55 <- data_3 %>%
  filter(year == 2011) %>%
  mutate(prop = (sum/sum(eleven$PATWT))*100)
close66 <- data_3 %>%
  filter(year == 2012) %>%
  mutate(prop = (sum/sum(twelve$PATWT))*100)
close77 <- data_3 %>%
  filter(year == 2013) %>%
  mutate(prop = (sum/sum(thirteen$PATWT))*100)
close88 <- data_3 %>%
  filter(year == 2014) %>%
  mutate(prop = (sum/sum(fourteen$PATWT))*100)
close99 <- data_3 %>%
  filter(year == 2015) %>%
  mutate(prop = (sum/sum(fifteen$PATWT))*100)
close100 <- data_3 %>%
  filter(year == 2016) %>%
  mutate(prop = (sum/sum(sixteen$PATWT))*100)

data_3summary <- rbind(close0, close11, close22, close33, close44, close55, close66, close77, close88, close99, close100) %>%
  select(year, prop)

write.csv(data_3summary, file = "opioids_rate_all.csv")

ggplot(data_3summary, aes(year, prop)) + 
  geom_line() +
  theme(legend.position = "none")
```

```{r}
# the opioid rate PER year amongst BEHAVIOURAL health patients by MED
data_4 <- data %>%
  select(year, AGE, PATWT, RFV1, RFV2, RFV3, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8) %>%
  unite(RFV, RFV1, RFV2, RFV3) %>%
   mutate(rn = row_number()) %>%
   separate_rows(RFV) %>%
   filter(RFV %in% c("Anxiety_Nervousness", "Fears_Phobias", "Depression", "Anger", "Problems_Identity_Self-esteem", "Restlessness", "Behavioral_Disturbances", "Antisocial_Behavior", "Hostile_Behavior", "Narcotic_Analgesics", "Hysterical_Behavior", "Temper_Problems", "Obsessions_Compulsions", "Disturbances_of_Sleep", "Insomnia", "Hypersomnia", "Nightmares", "Sleepwalking", "Sleep_Apnea", "Alcohol-related_Problems", "Abnormal_Drug_Usage", "Substance_Abuse", "Delusions_or_Hallucinations", "Other")) %>%
  ungroup() %>%
  select(-rn)

data_7 <- data_4 %>%
   select(year, AGE, RFV, PATWT, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8) %>%
  unite(MED, MED1, MED2, MED3, MED4, MED5, MED6, MED7, MED8) %>%
   mutate(rn = row_number()) %>%
   separate_rows(MED) %>%
   filter(MED %in% c("OXYCODONE", "PROPOXYPHENE", "REMIFENTANIL", "SUFENTANIL", "TAPENTADOL", "OXYMORPHONE", "PHENEROL", "MORPHINE", "NALBUPHINE", "Narcotic_Analgesics", "LEVORPHANOL", "MEPERIDINE", "METHADONE", "DIHYDROCODEINE", "FENTANYL", "HYDROCODONE", "HYDROMORPHONE", "OPIUM", "BUPRENORPHINE", "BUTORPHANOL", "CODEINE", "PHENYLPROPANOLAMINE", "DEZOCINE", "ALFENTANIL", "ALPHAPRODINE", "DEXTROPROPOXYPHENE", "PENTAZOCINE")) %>%
   group_by(rn, year, AGE, RFV) %>%
   summarise(PATWT = first(PATWT), MED = toString(unique(MED))) %>%
   ungroup() %>%
   select(-rn)

data_7b <- data_7 %>%
  select(year, PATWT, MED, RFV) %>%
  group_by(year, MED) %>%
  summarise(sum = sum(PATWT)) %>%
  mutate(row = row_number()) %>%
  separate_rows(MED) %>%
  pivot_wider(names_from = MED, values_from = sum) %>%
  select(-row) %>%
  group_by(year) %>%
  summarise(BUPRENORPHINE = sum(BUPRENORPHINE, na.rm=TRUE), CODEINE = sum(CODEINE, na.rm=TRUE), OXYCODONE = sum(OXYCODONE, na.rm=TRUE), FENTANYL = sum(FENTANYL, na.rm=TRUE), HYDROCODONE = sum(HYDROCODONE, na.rm=TRUE), METHADONE = sum(METHADONE, na.rm=TRUE), MEPERIDINE = sum(MEPERIDINE, na.rm=TRUE), HYDROMORPHONE = sum(HYDROMORPHONE, na.rm=TRUE), MORPHINE = sum(MORPHINE, na.rm=TRUE), OPIUM = sum(OPIUM, na.rm=TRUE), PROPOXYPHENE = sum(PROPOXYPHENE, na.rm=TRUE), BUTORPHANOL = sum(BUTORPHANOL, na.rm=TRUE), PENTAZOCINE = sum(PENTAZOCINE, na.rm=TRUE), OXYMORPHONE = sum(OXYMORPHONE, na.rm=TRUE))
```

```{r}
close <- data_7b %>%
  filter(year == 2006) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/20269468)*100, CODEINE = (CODEINE/20269468)*100, OXYCODONE = (OXYCODONE/20269468)*100, FENTANYL = (FENTANYL/20269468)*100, HYDROCODONE = (HYDROCODONE/20269468)*100, METHADONE = (METHADONE/20269468)*100, MEPERIDINE = (MEPERIDINE/20269468)*100, HYDROMORPHONE = (HYDROMORPHONE/20269468)*100, MORPHINE = (MORPHINE/20269468)*100, OPIUM = (OPIUM/20269468)*100, PROPOXYPHENE = (PROPOXYPHENE/20269468)*100, BUTORPHANOL = (BUTORPHANOL/20269468)*100, PENTAZOCINE = (PENTAZOCINE/20269468)*100, OXYMORPHONE = (OXYMORPHONE/20269468)*100) %>%
  mutate(year = 2006)
close1 <- data_7b %>%
  filter(year == 2007) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/25459104)*100, CODEINE = (CODEINE/25459104)*100, OXYCODONE = (OXYCODONE/25459104)*100, FENTANYL = (FENTANYL/25459104)*100, HYDROCODONE = (HYDROCODONE/25459104)*100, METHADONE = (METHADONE/25459104)*100, MEPERIDINE = (MEPERIDINE/25459104)*100, HYDROMORPHONE = (HYDROMORPHONE/25459104)*100, MORPHINE = (MORPHINE/25459104)*100, OPIUM = (OPIUM/25459104)*100, PROPOXYPHENE = (PROPOXYPHENE/25459104)*100, BUTORPHANOL = (BUTORPHANOL/25459104)*100, PENTAZOCINE = (PENTAZOCINE/25459104)*100, OXYMORPHONE = (OXYMORPHONE/25459104)*100) %>%
  mutate(year = 2007)
close2 <- data_7b %>%
  filter(year == 2008) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/21652844)*100, CODEINE = (CODEINE/21652844)*100, OXYCODONE = (OXYCODONE/21652844)*100, FENTANYL = (FENTANYL/21652844)*100, HYDROCODONE = (HYDROCODONE/21652844)*100, METHADONE = (METHADONE/21652844)*100, MEPERIDINE = (MEPERIDINE/21652844)*100, HYDROMORPHONE = (HYDROMORPHONE/21652844)*100, MORPHINE = (MORPHINE/21652844)*100, OPIUM = (OPIUM/21652844)*100, PROPOXYPHENE = (PROPOXYPHENE/21652844)*100, BUTORPHANOL = (BUTORPHANOL/21652844)*100, PENTAZOCINE = (PENTAZOCINE/21652844)*100, OXYMORPHONE = (OXYMORPHONE/21652844)*100) %>%
  mutate(year = 2008)
close3 <- data_7b %>%
  filter(year == 2009) %>%
    summarise(BUPRENORPHINE = (BUPRENORPHINE/29444981)*100, CODEINE = (CODEINE/29444981)*100, OXYCODONE = (OXYCODONE/29444981)*100, FENTANYL = (FENTANYL/29444981)*100, HYDROCODONE = (HYDROCODONE/29444981)*100, METHADONE = (METHADONE/29444981)*100, MEPERIDINE = (MEPERIDINE/29444981)*100, HYDROMORPHONE = (HYDROMORPHONE/29444981)*100, MORPHINE = (MORPHINE/29444981)*100, OPIUM = (OPIUM/29444981)*100, PROPOXYPHENE = (PROPOXYPHENE/29444981)*100, BUTORPHANOL = (BUTORPHANOL/29444981)*100, PENTAZOCINE = (PENTAZOCINE/29444981)*100, OXYMORPHONE = (OXYMORPHONE/29444981)*100) %>%
  mutate(year = 2009)
close4 <- data_7b %>%
  filter(year == 2010) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/19796686)*100, CODEINE = (CODEINE/19796686)*100, OXYCODONE = (OXYCODONE/19796686)*100, FENTANYL = (FENTANYL/19796686)*100, HYDROCODONE = (HYDROCODONE/19796686)*100, METHADONE = (METHADONE/19796686)*100, MEPERIDINE = (MEPERIDINE/19796686)*100, HYDROMORPHONE = (HYDROMORPHONE/19796686)*100, MORPHINE = (MORPHINE/19796686)*100, OPIUM = (OPIUM/19796686)*100, PROPOXYPHENE = (PROPOXYPHENE/19796686)*100, BUTORPHANOL = (BUTORPHANOL/19796686)*100, PENTAZOCINE = (PENTAZOCINE/19796686)*100, OXYMORPHONE = (OXYMORPHONE/19796686)*100)  %>%
  mutate(year = 2010)
close5 <- data_7b %>%
  filter(year == 2011) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/24487463)*100, CODEINE = (CODEINE/24487463)*100, OXYCODONE = (OXYCODONE/24487463)*100, FENTANYL = (FENTANYL/24487463)*100, HYDROCODONE = (HYDROCODONE/24487463)*100, METHADONE = (METHADONE/24487463)*100, MEPERIDINE = (MEPERIDINE/24487463)*100, HYDROMORPHONE = (HYDROMORPHONE/24487463)*100, MORPHINE = (MORPHINE/24487463)*100, OPIUM = (OPIUM/24487463)*100, PROPOXYPHENE = (PROPOXYPHENE/24487463)*100, BUTORPHANOL = (BUTORPHANOL/24487463)*100, PENTAZOCINE = (PENTAZOCINE/24487463)*100, OXYMORPHONE = (OXYMORPHONE/24487463)*100)  %>%
  mutate(year = 2011)
close6 <- data_7b %>%
  filter(year == 2012) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/23194257)*100, CODEINE = (CODEINE/23194257)*100, OXYCODONE = (OXYCODONE/23194257)*100, FENTANYL = (FENTANYL/23194257)*100, HYDROCODONE = (HYDROCODONE/23194257)*100, METHADONE = (METHADONE/23194257)*100, MEPERIDINE = (MEPERIDINE/23194257)*100, HYDROMORPHONE = (HYDROMORPHONE/23194257)*100, MORPHINE = (MORPHINE/23194257)*100, OPIUM = (OPIUM/23194257)*100, PROPOXYPHENE = (PROPOXYPHENE/23194257)*100, BUTORPHANOL = (BUTORPHANOL/23194257)*100, PENTAZOCINE = (PENTAZOCINE/23194257)*100, OXYMORPHONE = (OXYMORPHONE/23194257)*100)  %>%
  mutate(year = 2012)
close7 <- data_7b %>%
  filter(year == 2013) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/26104582)*100, CODEINE = (CODEINE/26104582)*100, OXYCODONE = (OXYCODONE/26104582)*100, FENTANYL = (FENTANYL/26104582)*100, HYDROCODONE = (HYDROCODONE/26104582)*100, METHADONE = (METHADONE/26104582)*100, MEPERIDINE = (MEPERIDINE/26104582)*100, HYDROMORPHONE = (HYDROMORPHONE/26104582)*100, MORPHINE = (MORPHINE/26104582)*100, OPIUM = (OPIUM/26104582)*100, PROPOXYPHENE = (PROPOXYPHENE/26104582)*100, BUTORPHANOL = (BUTORPHANOL/26104582)*100, PENTAZOCINE = (PENTAZOCINE/26104582)*100, OXYMORPHONE = (OXYMORPHONE/26104582)*100)  %>%
  mutate(year = 2013)
close8 <- data_7b %>%
  filter(year == 2014) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/26381133)*100, CODEINE = (CODEINE/26381133)*100, OXYCODONE = (OXYCODONE/26381133)*100, FENTANYL = (FENTANYL/26381133)*100, HYDROCODONE = (HYDROCODONE/26381133)*100, METHADONE = (METHADONE/26381133)*100, MEPERIDINE = (MEPERIDINE/26381133)*100, HYDROMORPHONE = (HYDROMORPHONE/26381133)*100, MORPHINE = (MORPHINE/26381133)*100, OPIUM = (OPIUM/26381133)*100, PROPOXYPHENE = (PROPOXYPHENE/26381133)*100, BUTORPHANOL = (BUTORPHANOL/26381133)*100, PENTAZOCINE = (PENTAZOCINE/26381133)*100, OXYMORPHONE = (OXYMORPHONE/26381133)*100) %>%
  mutate(year = 2014)
close9 <- data_7b %>%
  filter(year == 2015) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/32317730)*100, CODEINE = (CODEINE/32317730)*100, OXYCODONE = (OXYCODONE/32317730)*100, FENTANYL = (FENTANYL/32317730)*100, HYDROCODONE = (HYDROCODONE/32317730)*100, METHADONE = (METHADONE/32317730)*100, MEPERIDINE = (MEPERIDINE/32317730)*100, HYDROMORPHONE = (HYDROMORPHONE/32317730)*100, MORPHINE = (MORPHINE/32317730)*100, OPIUM = (OPIUM/32317730)*100, PROPOXYPHENE = (PROPOXYPHENE/32317730)*100, BUTORPHANOL = (BUTORPHANOL/32317730)*100, PENTAZOCINE = (PENTAZOCINE/32317730)*100, OXYMORPHONE = (OXYMORPHONE/32317730)*100)  %>%
  mutate(year = 2015)
close10 <- data_7b %>%
  filter(year == 2016) %>%
  summarise(BUPRENORPHINE = (BUPRENORPHINE/20341365)*100, CODEINE = (CODEINE/20341365)*100, OXYCODONE = (OXYCODONE/20341365)*100, FENTANYL = (FENTANYL/20341365)*100, HYDROCODONE = (HYDROCODONE/20341365)*100, METHADONE = (METHADONE/20341365)*100, MEPERIDINE = (MEPERIDINE/20341365)*100, HYDROMORPHONE = (HYDROMORPHONE/20341365)*100, MORPHINE = (MORPHINE/20341365)*100, OPIUM = (OPIUM/20341365)*100, PROPOXYPHENE = (PROPOXYPHENE/20341365)*100, BUTORPHANOL = (BUTORPHANOL/20341365)*100, PENTAZOCINE = (PENTAZOCINE/20341365)*100, OXYMORPHONE = (OXYMORPHONE/20341365)*100)  %>%
  mutate(year = 2016)

data_8summary <- rbind(close, close1, close2, close3, close4, close5, close6, close7, close8, close9, close10)

write.csv(data_8summary, file = "mental_rate_bymed.csv")

data_8summaryb <- data_7b %>%
   pivot_longer(
      cols = BUPRENORPHINE:OXYMORPHONE, 
      names_to = "MED", 
      values_to = "yes")
```

```{r}
#mental health patients stats tests by drug
close12 <- data_8summaryb %>%
  filter(year == 2006) %>%
  mutate(prop = 20269468)
close112 <- data_8summaryb %>%
  filter(year == 2007) %>%
  mutate(prop = 25459104)
close212 <- data_8summaryb %>%
  filter(year == 2008) %>%
  mutate(prop = 21652844)
close312 <- data_8summaryb %>%
  filter(year == 2009) %>%
  mutate(prop = 29444981)
close412 <- data_8summaryb %>%
  filter(year == 2010) %>%
  mutate(prop = 19796686)
close512 <- data_8summaryb %>%
  filter(year == 2011) %>%
  mutate(prop = 24487463)
close612 <- data_8summaryb %>%
  filter(year == 2012) %>%
  mutate(prop = 23194257)
close712 <- data_8summaryb %>%
  filter(year == 2013) %>%
  mutate(prop = 26104582)
close812 <- data_8summaryb %>%
  filter(year == 2014) %>%
  mutate(prop = 26381133)
close912 <- data_8summaryb %>%
  filter(year == 2015) %>%
  mutate(prop = 32317730)
close1012 <- data_8summaryb %>%
  filter(year == 2016) %>%
  mutate(prop = 20341365)


data_8summary12 <- rbind(close12, close112, close212, close312, close412, close512, close612, close712, close812, close912, close1012) %>%
  mutate(no = prop) %>%
  select(year, MED, yes, no)

unique(data_8summaryb$MED)

codeine2 <- data_8summary12 %>%
  filter(MED == "CODEINE")

proptest_cod2 <- pairwise.prop.test(codeine2$yes, codeine2$no)
proptest_cod2

proptrend_cod2 <- prop.trend.test(codeine2$yes, codeine2$no)
proptrend_cod2

BUPRENORPHINE2 <- data_8summary12 %>%
  filter(MED == "BUPRENORPHINE")

proptest_bup2 <- pairwise.prop.test(BUPRENORPHINE2$yes, BUPRENORPHINE2$no)
proptest_bup2

proptrend_bup2 <- prop.trend.test(BUPRENORPHINE2$yes, BUPRENORPHINE2$no)
proptrend_bup2

FENTANYL2 <- data_8summary12 %>%
  filter(MED == "FENTANYL")

proptest_fen2 <- pairwise.prop.test(FENTANYL2$yes, FENTANYL2$no)
proptest_fen2

proptrend_fen2 <- prop.trend.test(FENTANYL2$yes, FENTANYL2$no)
proptrend_fen2

HYDROMORPHONE2 <- data_8summary12 %>%
  filter(MED == "HYDROMORPHONE")

proptest_hmo2 <- pairwise.prop.test(HYDROMORPHONE2$yes, HYDROMORPHONE2$no)
proptest_hmo2

proptrend_hmo2 <- prop.trend.test(HYDROMORPHONE2$yes, HYDROMORPHONE2$no)
proptrend_hmo2

METHADONE2 <- data_8summary12 %>%
  filter(MED == "METHADONE")

proptest_met2 <- pairwise.prop.test(METHADONE2$yes, METHADONE2$no)
proptest_met2

proptrend_met2 <- prop.trend.test(METHADONE2$yes, METHADONE2$no)
proptrend_met2

MORPHINE2 <- data_8summary12 %>%
  filter(MED == "MORPHINE")

proptest_mor2 <- pairwise.prop.test(MORPHINE2$yes, MORPHINE2$no)
proptest_mor2

proptrend_mor2 <- prop.trend.test(MORPHINE2$yes, MORPHINE2$no)
proptrend_mor2

OPIUM2 <- data_8summary12 %>%
  filter(MED == "OPIUM")

proptest_opi2 <- pairwise.prop.test(OPIUM2$yes, OPIUM2$no)
proptest_opi2

proptrend_opi2 <- prop.trend.test(OPIUM2$yes, OPIUM2$no)
proptrend_opi2

OXYCODONE2 <- data_8summary12 %>%
  filter(MED == "OXYCODONE")

proptest_oxy2 <- pairwise.prop.test(OXYCODONE2$yes, OXYCODONE2$no)
proptest_oxy2

proptrend_oxy2 <- prop.trend.test(OXYCODONE2$yes, OXYCODONE2$no)
proptrend_oxy2

BUPRENORPHINE2 <- data_8summary12 %>%
  filter(MED == "BUPRENORPHINE")

proptest_bne2 <- pairwise.prop.test(BUPRENORPHINE2$yes, BUPRENORPHINE2$no)
proptest_bne2

proptrend_bne2 <- prop.trend.test(BUPRENORPHINE2$yes, BUPRENORPHINE2$no)
proptrend_bne2

HYDROCODONE2 <- data_8summary12 %>%
  filter(MED == "HYDROCODONE")

proptest_hyd2 <- pairwise.prop.test(HYDROCODONE2$yes, HYDROCODONE2$no)
proptest_hyd2

proptrend_hyd2 <- prop.trend.test(HYDROCODONE2$yes, HYDROCODONE2$no)
proptrend_hyd2

MEPERIDINE2 <- data_8summary12 %>%
  filter(MED == "MEPERIDINE")

proptest_mep2 <- pairwise.prop.test(MEPERIDINE2$yes, MEPERIDINE2$no)
proptest_mep2

proptrend_mep2 <- prop.trend.test(MEPERIDINE2$yes, MEPERIDINE2$no)
proptrend_mep2

PROPOXYPHENE2 <- data_8summary12 %>%
  filter(MED == "PROPOXYPHENE")

proptest_mep2 <- pairwise.prop.test(PROPOXYPHENE2$yes, PROPOXYPHENE2$no)
proptest_mep2

proptrend_mep2 <- prop.trend.test(PROPOXYPHENE2$yes, PROPOXYPHENE2$no)
proptrend_mep2

BUTORPHANOL2 <- data_8summary12 %>%
  filter(MED == "BUTORPHANOL")

proptest_but2 <- pairwise.prop.test(BUTORPHANOL2$yes, BUTORPHANOL2$no)
proptest_but2

proptrend_but2 <- prop.trend.test(BUTORPHANOL2$yes, BUTORPHANOL2$no)
proptrend_but2

PENTAZOCINE2 <- data_8summary12 %>%
  filter(MED == "PENTAZOCINE")

proptest_pen2 <- pairwise.prop.test(PENTAZOCINE2$yes, PENTAZOCINE2$no)
proptest_pen2

proptrend_pen2 <- prop.trend.test(PENTAZOCINE2$yes, PENTAZOCINE2$no)
proptrend_pen2

OXYMORPHONE2 <- data_8summary12 %>%
  filter(MED == "OXYMORPHONE")

proptest_oxm2 <- pairwise.prop.test(OXYMORPHONE2$yes, OXYMORPHONE2$no)
proptest_oxm2

proptrend_oxm2 <- prop.trend.test(OXYMORPHONE2$yes, OXYMORPHONE2$no)
proptrend_oxm2
```

```{r}
# the overall opioid rate PER year amongst behavioural health patients ONLY
data_6 <- data_8summary12 %>%
  group_by(year) %>%
  summarise(total = sum(yes))

closea <- data_6 %>%
  filter(year == 2006) %>%
  mutate(prop = (total/20269468)*100)
closeb <- data_6 %>%
  filter(year == 2007) %>%
  mutate(prop = (total/25459104)*100)
closec <- data_6 %>%
  filter(year == 2008) %>%
  mutate(prop = (total/21652844)*100)
closed <- data_6 %>%
  filter(year == 2009) %>%
  mutate(prop = (total/29444981)*100)
closee <- data_6 %>%
  filter(year == 2010) %>%
  mutate(prop = (total/19796686)*100)
closef <- data_6 %>%
  filter(year == 2011) %>%
  mutate(prop = (total/24487463)*100)
closeg <- data_6 %>%
  filter(year == 2012) %>%
  mutate(prop = (total/23194257)*100)
closeh <- data_6 %>%
  filter(year == 2013) %>%
  mutate(prop = (total/26104582)*100)
closei <- data_6 %>%
  filter(year == 2014) %>%
  mutate(prop = (total/26381133)*100)
closej <- data_6 %>%
  filter(year == 2015) %>%
  mutate(prop = (total/32317730)*100)
closek <- data_6 %>%
  filter(year == 2016) %>%
  mutate(prop = (total/20341365)*100)

data_6summary <- rbind(closea, closeb, closec, closed, closee, closef, closeg, closeh, closei, closej, closek) %>%
  select(year, prop)

data_6summary$prop <- as.numeric(as.character(data_6summary$prop)) 

write.csv(data_6summary, file = "mental_rate_overall.csv")

scatter.smooth(x=data_6summary$year, y=data_6summary$prop) +
  title(main="Opioid Prescriptions Per Capita")

closeab <- data_6 %>%
  filter(year == 2006) %>%
  mutate(prop = 20269468)
closebb <- data_6 %>%
  filter(year == 2007) %>%
  mutate(prop = 25459104)
closecb <- data_6 %>%
  filter(year == 2008) %>%
  mutate(prop = 21652844)
closedb <- data_6 %>%
  filter(year == 2009) %>%
  mutate(prop = 29444981)
closeeb <- data_6 %>%
  filter(year == 2010) %>%
  mutate(prop = 19796686)
closefb <- data_6 %>%
  filter(year == 2011) %>%
  mutate(prop = 24487463)
closegb <- data_6 %>%
  filter(year == 2012) %>%
  mutate(prop = 23194257)
closehb <- data_6 %>%
  filter(year == 2013) %>%
  mutate(prop = 26104582)
closeib <- data_6 %>%
  filter(year == 2014) %>%
  mutate(prop = 26381133)
closejb <- data_6 %>%
  filter(year == 2015) %>%
  mutate(prop = 32317730)
closekb <- data_6 %>%
  filter(year == 2016) %>%
  mutate(prop = 20341365)

data_6summaryb <- rbind(closeab, closebb, closecb, closedb, closeeb, closefb, closegb, closehb, closeib, closejb, closekb) %>%
  mutate(no = prop) %>%
  mutate(yes = total) %>%
  select(year, yes, no)

proptest2 <- pairwise.prop.test(data_6summaryb$yes, data_6summaryb$no)
proptest2

proptrend2 <- prop.trend.test(data_6summaryb$yes, data_6summaryb$no)
proptrend2
```